(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["MetadataMixin","MetadataDetail","MetadataList"],{1344:function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("b-overlay",{attrs:{show:t.paginator.loading,rounded:"sm"}},[e("b-table",{ref:"metadataTable",attrs:{id:t.paginator.ariaControl,items:t.paginator.items,fields:t.metadataTableFields,caption:t.metadataTableCaption,"primary-key":"oid","select-mode":"single",small:"",hover:"",selectable:""},on:{"row-selected":t.showMetadataDetailModal},scopedSlots:t._u([{key:"cell(checkbox)",fn:function(a){return[e("b-form-checkbox",{attrs:{value:a.item,size:"lg"},model:{value:t.selection,callback:function(a){t.selection=a},expression:"selection"}})]}},{key:"cell(download_button)",fn:function(t){return[e("b-button",{attrs:{href:t.value,target:"_blank",title:"Download file",size:"sm",variant:"primary",disabled:t.item.data_location.offline}},[e("b-icon",{attrs:{icon:"download"}})],1)]}}])}),e("b-button-toolbar",{attrs:{"key-nav":""}},[e("b-button",{attrs:{disabled:t.selectionEmpty,variant:"primary",title:"Select one or more metadata to create or update a data selection"},on:{click:t.saveSelection}},[t._v("Save selection ("+t._s(t.selection.length)+")")]),e("b-button",{attrs:{variant:"primary",title:"Create or update a data selection with all metadata"},on:{click:t.saveAll}},[t._v("Save all")]),e("b-button",{attrs:{disabled:t.selectionEmpty,title:"Select one or more metadata to search for overlapping data"},on:{click:t.searchOverlappingDatasets}},[t._v("Search overlapping")]),e("span",{staticClass:"button-toolbar-spacer"}),e("b-pagination",{staticClass:"mb-0",attrs:{"total-rows":t.paginator.totalRows,"per-page":t.paginator.pageSize,"aria-controls":t.paginator.ariaControl,limit:"5"},model:{value:t.paginator.pageNumber,callback:function(a){t.$set(t.paginator,"pageNumber",a)},expression:"paginator.pageNumber"}})],1)],1),e("b-modal",{ref:"metadataDetailModal",attrs:{size:"md",title:t.metadataDetailModalTitle,"hide-footer":"",static:"",lazy:""}},[t.metadataDetailModalMetadata?e("metadata-detail",{attrs:{metadata:t.metadataDetailModalMetadata}}):t._e()],1),e("b-modal",{ref:"overlappingDatasetsModal",attrs:{size:"xl",title:t.overlappingDatasetsModalTitle,"hide-footer":"",static:"",lazy:""}},[e("dataset",{attrs:{"initial-search-filter":t.overlappingDatasetsModalSearchFilter}})],1),e("data-selection-save",{ref:"dataSelectionSave"})],1)},n=[],i=e("2909"),s=(e("d3b7"),e("3ca3"),e("ddb0"),e("2b3d"),e("b0c0"),e("99af"),e("a15b"),e("d81d"),e("159b"),e("25f0"),e("1fdb")),l=e("eaef"),o=e("72f4"),c=e("da68"),d={name:"MetadataList",components:{MetadataDetail:c["default"],Dataset:o["default"],DataSelectionSave:l["a"]},props:{dataset:{type:Object,required:!0},searchParams:{type:URLSearchParams,required:!0},columns:{type:Array,required:!0}},data:function(){return{paginator:this.$SVO.getPaginator(this.dataset.metadata.resource_uri),selection:[],metadataDetailModalTitle:this.dataset.name,metadataDetailModalMetadata:null,overlappingDatasetsModalSearchFilter:new s["a"],overlappingDatasetsModalTitle:"Datasets"}},computed:{metadataTableFields:function(){return[{key:"checkbox",label:""},{key:"download_button",label:"Download",formatter:function(t,a,e){return e.data_location.offline?null:e.data_location.file_url}}].concat(Object(i["a"])(this.columns),[{key:"tags",label:"Tags",formatter:function(t){return t.map((function(t){return t.name})).join(", ")}}])},metadataTableCaption:function(){return this.paginator.items.length>0?"Click on any row to see data details":"No metadata correspond to your search criteria"},selectionEmpty:function(){return 0==this.selection.length}},watch:{searchParams:{handler:"updatePaginator",immediate:!0}},methods:{updatePaginator:function(t){this.selection=[];try{this.paginator.searchParams=t,this.paginator.loadPage(1)}catch(a){this.$displayErrorMessage(this.$SVO.parseError(a))}},showMetadataDetailModal:function(t){t.length>0&&(this.metadataDetailModalMetadata=t[0],this.$refs.metadataTable.clearSelected(),this.$nextTick((function(){this.$refs.metadataDetailModal.show()})))},saveSelection:function(){var t=new URLSearchParams;this.selection.forEach((function(a){return t.append("oid__in",a.oid)})),this.$refs.dataSelectionSave.save(this.dataset,t.toString())},saveAll:function(){this.$refs.dataSelectionSave.save(this.dataset,this.searchParams.toString())},searchOverlappingDatasets:function(){this.overlappingDatasetsModalTitle="Datasets overlapping selected ".concat(this.dataset.name," data"),this.overlappingDatasetsModalSearchFilter=new s["a"]({dateRange:{min:new Date(Math.min.apply(Math,Object(i["a"])(this.selection.map((function(t){return new Date(t.date_beg)}))))),max:new Date(Math.max.apply(Math,Object(i["a"])(this.selection.map((function(t){return new Date(t.date_end)})))))},search:this.selection.map((function(t){return"(date_beg__lt = ".concat(t.date_end," and date_end__gt = ").concat(t.date_beg,")")})).join(" or ")}),this.$refs.overlappingDatasetsModal.show()}}},u=d,h=e("2877"),m=Object(h["a"])(u,r,n,!1,null,null,null);a["default"]=m.exports},1814:function(t,a,e){"use strict";e.r(a);var r=e("1da1"),n=(e("96cf"),e("d3b7"),e("3ca3"),e("ddb0"),e("2b3d"),e("b0c0"),e("d81d"),e("1344")),i=e("79d4");a["default"]={components:{MetadataList:n["default"]},props:{dataset:{type:Object,required:!0},initialSearchFilter:{type:Object,required:!1,default:null}},data:function(){return{searchFilter:new i["a"](this.initialSearchFilter),searchParams:new URLSearchParams,tagOptions:[],columns:[{label:"Observation date",key:"date_beg",formatter:this.$utils.formatDate},{label:"Wavelength",key:"wavemin"}]}},created:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.showOverlay=!0,this.loadTagOptions(),this.showOverlay=!1;case 3:case"end":return t.stop()}}),t,this)})));function a(){return t.apply(this,arguments)}return a}(),methods:{updateSearchParams:function(){this.searchParams=this.searchFilter.getSearchParams()},loadTagOptions:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$SVO.tag.getAll({dataset:this.dataset.name});case 3:a=t.sent,this.tagOptions=a.map((function(t){return{value:t.name,text:t.name}})),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),this.$displayErrorMessage(this.$SVO.parseError(t.t0));case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));function a(){return t.apply(this,arguments)}return a}()}}},"1e25":function(t,a,e){"use strict";var r=e("23e7"),n=e("58a8").end,i=e("c8d2"),s=i("trimEnd"),l=s?function(){return n(this)}:"".trimEnd;r({target:"String",proto:!0,forced:s},{trimEnd:l,trimRight:l})},"466d":function(t,a,e){"use strict";var r=e("d784"),n=e("825a"),i=e("50c4"),s=e("1d80"),l=e("8aa5"),o=e("14c3");r("match",(function(t,a,e){return[function(a){var e=s(this),r=void 0==a?void 0:a[t];return void 0!==r?r.call(a,e):new RegExp(a)[t](String(e))},function(t){var r=e(a,this,t);if(r.done)return r.value;var s=n(this),c=String(t);if(!s.global)return o(s,c);var d=s.unicode;s.lastIndex=0;var u,h=[],m=0;while(null!==(u=o(s,c))){var p=String(u[0]);h[m]=p,""===p&&(s.lastIndex=l(c,i(s.lastIndex),d)),m++}return 0===m?null:h}]}))},"79d4":function(t,a,e){"use strict";e.d(a,"a",(function(){return o}));var r=e("b85c"),n=e("2909"),i=e("d4ec"),s=e("bee2"),l=e("ade3"),o=(e("ac1f"),e("841c"),e("d3b7"),e("3ca3"),e("ddb0"),e("2b3d"),function(){function t(a){Object(i["a"])(this,t),Object(l["a"])(this,"tags",[]),Object(l["a"])(this,"dateRange",{min:null,max:null}),a&&(Array.isArray(a.tags)&&(this.tags=Object(n["a"])(a.tags)),a.dateRange&&(this.dateRange={min:a.dateRange.min,max:a.dateRange.max}),this.search=a.search)}return Object(s["a"])(t,[{key:"getSearchParams",value:function(){var t,a=new URLSearchParams,e=Object(r["a"])(this.tags);try{for(e.s();!(t=e.n()).done;){var n=t.value;a.append("tags__in",n)}}catch(i){e.e(i)}finally{e.f()}return this.dateRange.min&&a.set("date_end__gte",this.dateRange.min.toISOString()),this.dateRange.max&&a.set("date_beg__lte",this.dateRange.max.toISOString()),this.search&&a.set("search",this.search),a}}]),t}())},da68:function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("b-img",{attrs:{src:t.imageURL,center:"","fluid-grow":"",alt:"Data thumbnail"}}),e("b-form-group",{staticClass:"my-2"},[e("b-input-group",[e("b-form-input",{attrs:{type:"search",placeholder:"Filter metadata",debounce:"250"},model:{value:t.searchFilter,callback:function(a){t.searchFilter=a},expression:"searchFilter"}}),e("b-input-group-append",[e("b-button",{attrs:{disabled:!t.searchFilter},on:{click:t.clearSearchFilter}},[t._v("Clear")])],1)],1)],1),e("b-table",{attrs:{items:t.cards,fields:t.fields,filter:t.searchFilter,"filter-included-fields":t.filterIncludedFields,"primary-key":"id","sticky-header":"","show-empty":"",small:""}})],1)},n=[],i=e("3835"),s=(e("1e25"),e("d81d"),e("ac1f"),e("466d"),e("4de4"),e("4fad"),e("99af"),{name:"MetadataDetail",props:{metadata:{type:Object,required:!0}},data:function(){return{searchFilter:""}},computed:{imageURL:function(){return this.metadata.data_location.thumbnail_url?this.metadata.data_location.thumbnail_url:e("14e6")},fitsHeader:function(){return this.metadata.fits_header?this.metadata.fits_header.trimEnd():""},fields:function(){return[{key:"text",label:this.fitsHeader.length>0?"FITS header":"Metadata"}]},filterIncludedFields:function(){return["text"]},cards:function(){return this.fitsHeader.length>0?this.fitsHeader.match(/[^]{1,80}/g).map((function(t,a){return{id:a,text:t}})):Object.entries(this.metadata).filter((function(t){var a=Object(i["a"])(t,2),e=a[1];return!(e instanceof Object)})).map((function(t,a){var e=Object(i["a"])(t,2),r=e[0],n=e[1];return{id:a,text:"".concat(r," = ").concat(n)}}))}},methods:{clearSearchFilter:function(){this.searchFilter=""}}}),l=s,o=e("2877"),c=Object(o["a"])(l,r,n,!1,null,null,null);a["default"]=c.exports}}]);
//# sourceMappingURL=MetadataMixin.4da71f8a.js.map