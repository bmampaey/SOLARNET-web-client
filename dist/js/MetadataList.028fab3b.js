(self["webpackChunksvo"]=self["webpackChunksvo"]||[]).push([[496,219],{16458:function(t,e,a){"use strict";a.d(e,{Z:function(){return c}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("nav",{attrs:{role:"navigation","aria-label":"Pagination","aria-controls":t.ariaControls}},[a("b-button",{staticClass:"mr-1",attrs:{disabled:1==t.currentPage,size:"sm",variant:"outline-dark",title:t.ariaLabel(t.jumpBackwardPage),"aria-label":t.ariaLabel(t.jumpBackwardPage)},on:{click:function(e){return t.selectPage(t.jumpBackwardPage)}}},[t._v(" « ")]),a("b-button-group",{attrs:{size:"sm"}},t._l(t.pages,(function(e){return a("b-button",{key:e,attrs:{disabled:t.currentPage==e,variant:e==t.currentPage?"primary":"outline-primary",title:t.ariaLabel(e),"aria-label":t.ariaLabel(e),"aria-current":e==t.currentPage?"page":"false"},on:{click:function(a){return t.selectPage(e)}}},[t._v(" "+t._s(e)+" ")])})),1),a("b-button",{staticClass:"ml-1",attrs:{disabled:t.currentPage==t.pageCount,size:"sm",variant:"outline-dark",title:t.ariaLabel(t.jumpForwardPage),"aria-label":t.ariaLabel(t.jumpForwardPage)},on:{click:function(e){return t.selectPage(t.jumpForwardPage)}}},[t._v(" » ")])],1)},n=[],i=(a(9653),{props:{value:{type:Number,required:!0},pageCount:{type:Number,required:!0},pageJump:{type:Number,default:10},pageDisplayed:{type:Number,default:5},ariaControls:{type:String,default:null}},data:function(){return{currentPage:this.value}},computed:{jumpBackwardPage:function(){return Math.max(1,this.currentPage-this.pageJump)},jumpForwardPage:function(){return Math.min(this.pageCount,this.currentPage+this.pageJump)},firstPage:function(){var t=Math.ceil(this.pageDisplayed/2);return Math.max(1,this.currentPage-t+1)},lastPage:function(){return Math.min(this.pageCount,this.firstPage+this.pageDisplayed-1)},pages:function(){for(var t=[],e=this.firstPage;e<=this.lastPage;e++)t.push(e);return t}},methods:{selectPage:function(t){t!=this.currentPage&&(this.currentPage=t,this.$emit("input",this.currentPage))},ariaLabel:function(t){return t==this.currentPage?null:"Go to Page ".concat(t)}}}),s=i,o=a(1001),l=(0,o.Z)(s,r,n,!1,null,null,null),c=l.exports},5688:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return u}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-img",{attrs:{src:t.imageURL,center:"","fluid-grow":"",alt:"Data thumbnail"}}),a("b-form-group",{staticClass:"my-2"},[a("b-input-group",[a("b-form-input",{attrs:{type:"search",placeholder:"Filter metadata",debounce:"250"},model:{value:t.searchFilter,callback:function(e){t.searchFilter=e},expression:"searchFilter"}}),a("b-input-group-append",[a("b-button",{attrs:{disabled:!t.searchFilter},on:{click:t.clearSearchFilter}},[t._v("Clear")])],1)],1)],1),a("b-table",{attrs:{items:t.cards,fields:t.fields,filter:t.searchFilter,"filter-included-fields":t.filterIncludedFields,"primary-key":"id","sticky-header":"","show-empty":"",small:""}})],1)},n=[],i=a(75200),s=(a(48702),a(21249),a(74916),a(4723),a(57327),a(41539),a(69720),a(92222),{name:"MetadataDetail",props:{metadata:{type:Object,required:!0}},data:function(){return{searchFilter:""}},computed:{imageURL:function(){return this.metadata.data_location.thumbnail_url?this.metadata.data_location.thumbnail_url:a(61170)},fitsHeader:function(){return this.metadata.fits_header?this.metadata.fits_header.trimEnd():""},fields:function(){return[{key:"text",label:this.fitsHeader.length>0?"FITS header":"Metadata"}]},filterIncludedFields:function(){return["text"]},cards:function(){return this.fitsHeader.length>0?this.fitsHeader.match(/[^]{1,80}/g).map((function(t,e){return{id:e,text:t}})):Object.entries(this.metadata).filter((function(t){var e=(0,i.Z)(t,2),a=e[1];return!(a instanceof Object)})).map((function(t,e){var a=(0,i.Z)(t,2),r=a[0],n=a[1];return{id:e,text:"".concat(r," = ").concat(n)}}))}},methods:{clearSearchFilter:function(){this.searchFilter=""}}}),o=s,l=a(1001),c=(0,l.Z)(o,r,n,!1,null,null,null),u=c.exports},46848:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return S}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-overlay",{attrs:{show:t.paginator.loading,rounded:"sm"}},[a("b-table",{ref:"metadataTable",attrs:{id:t.paginator.ariaControls,items:t.paginator.items,fields:t.metadataTableFields,caption:t.metadataTableCaption,"primary-key":"oid","select-mode":"single",small:"",hover:"",selectable:""},on:{"row-selected":t.showMetadataDetailModal},scopedSlots:t._u([{key:"cell(checkbox)",fn:function(e){return[a("b-form-checkbox",{attrs:{value:e.item,size:"lg"},model:{value:t.selection,callback:function(e){t.selection=e},expression:"selection"}})]}},{key:"cell(download_button)",fn:function(t){return[a("b-button",{attrs:{href:t.value,target:"_blank",title:"Download file",size:"sm",variant:"primary",disabled:t.item.data_location.offline}},[a("b-icon",{attrs:{icon:"download"}})],1)]}}])}),a("b-button-toolbar",{attrs:{"key-nav":""}},[a("b-button",{attrs:{disabled:t.selectionEmpty,variant:"primary",title:"Select one or more metadata to create or update a data selection"},on:{click:t.saveSelection}},[t._v("Save selection ("+t._s(t.selection.length)+")")]),a("b-button",{attrs:{variant:"primary",title:"Create or update a data selection with all metadata"},on:{click:t.saveAll}},[t._v("Save all")]),a("b-button",{attrs:{disabled:t.selectionEmpty,title:"Select one or more metadata to search for overlapping data"},on:{click:t.searchOverlappingDatasets}},[t._v("Search overlapping")]),a("span",{staticClass:"button-toolbar-spacer"}),a("pagination",{staticClass:"mb-0",attrs:{"page-count":t.paginator.pageCount,"aria-controls":t.paginator.ariaControls},model:{value:t.paginator.pageNumber,callback:function(e){t.$set(t.paginator,"pageNumber",e)},expression:"paginator.pageNumber"}})],1)],1),a("b-modal",{ref:"metadataDetailModal",attrs:{size:"md",title:t.metadataDetailModalTitle,"hide-footer":"",static:"",lazy:""}},[t.metadataDetailModalMetadata?a("metadata-detail",{attrs:{metadata:t.metadataDetailModalMetadata}}):t._e()],1),a("b-modal",{ref:"overlappingDatasetsModal",attrs:{size:"xl",title:t.overlappingDatasetsModalTitle,"hide-footer":"",static:"",lazy:""}},[a("dataset",{attrs:{"initial-search-filter":t.overlappingDatasetsModalSearchFilter}})],1),a("data-selection-save",{ref:"dataSelectionSave"})],1)},n=[],i=a(68932),s=(a(41539),a(78783),a(33948),a(41637),a(68309),a(92222),a(69600),a(21249),a(54747),a(39714),a(90760)),o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("b-modal",{ref:"dataSelectionSaveModal",attrs:{size:"md",title:"Save data selection","ok-only":"","ok-variant":"success","hide-footer":!t.dataSelection},on:{hidden:t.resetModal}},[t.dataSelection?[t._v(" Your selection was saved successfully, and is available under the menu "),a("b-link",{attrs:{to:{name:"DataSelections"}}},[t._v('"Data selections"')])]:[a("b-overlay",{attrs:{show:t.showOverlay,rounded:"sm"}},[a("b-form",{on:{submit:function(e){return e.preventDefault(),t.saveDataSelection.apply(null,arguments)}}},[a("b-form-group",{attrs:{label:"Description","label-for":"data-selection-description",description:"Optional description of the data selection"}},[a("b-form-textarea",{attrs:{id:"data-selection-description",lazy:""},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}})],1),a("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("Save")])],1)],1),a("p",{staticClass:"text-muted mt-3"},[t._v(" Note: data selections are dynamic, if metadata corresponding to your selection is added, updated or deleted, the selection will be affected ")])]],2)],1)},l=[],c=a(16198),u=(a(35666),a(82526),a(41817),{name:"DataSelectionSave",data:function(){return{showOverlay:!1,description:null,dataSelection:null}},methods:{save:function(t,e){this.dataset=t,this.query_string=e,this.$refs.dataSelectionSaveModal.show()},saveDataSelection:function(){var t=(0,c.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.showOverlay=!0,t.prev=1,t.next=4,this.$SVO.data_selection.create({description:this.description,dataset:this.dataset.resource_uri,query_string:this.query_string});case 4:this.dataSelection=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](1),this.$displayErrorMessage(this.$SVO.parseError(t.t0));case 10:this.showOverlay=!1;case 11:case"end":return t.stop()}}),t,this,[[1,7]])})));function e(){return t.apply(this,arguments)}return e}(),resetModal:function(){this.showOverlay=!1,this.description=null,this.dataSelection=null}}}),d=u,p=a(1001),h=(0,p.Z)(d,o,l,!1,null,null,null),f=h.exports,m=a(69993),g=a(16458),b=a(5688),v={name:"MetadataList",components:{MetadataDetail:b["default"],Dataset:m["default"],DataSelectionSave:f,Pagination:g.Z},props:{dataset:{type:Object,required:!0},searchParams:{type:URLSearchParams,required:!0},columns:{type:Array,required:!0}},data:function(){return{paginator:this.$SVO.getPaginator(this.dataset.metadata.resource_uri),selection:[],metadataDetailModalTitle:this.dataset.name,metadataDetailModalMetadata:null,overlappingDatasetsModalSearchFilter:new s.Z,overlappingDatasetsModalTitle:"Datasets"}},computed:{metadataTableFields:function(){return[{key:"checkbox",label:""},{key:"download_button",label:"Download",formatter:function(t,e,a){return a.data_location.offline?null:a.data_location.file_url}}].concat((0,i.Z)(this.columns),[{key:"tags",label:"Tags",formatter:function(t){return t.map((function(t){return t.name})).join(", ")}}])},metadataTableCaption:function(){return this.paginator.items.length>0?"Click on any row to see data details":"No metadata correspond to your search criteria"},selectionEmpty:function(){return 0==this.selection.length}},watch:{searchParams:{handler:"updatePaginator",immediate:!0}},methods:{updatePaginator:function(t){this.selection=[];try{this.paginator.searchParams=t,this.paginator.loadPage(1)}catch(e){this.$displayErrorMessage(this.$SVO.parseError(e))}},showMetadataDetailModal:function(t){t.length>0&&(this.metadataDetailModalMetadata=t[0],this.$refs.metadataTable.clearSelected(),this.$nextTick((function(){this.$refs.metadataDetailModal.show()})))},saveSelection:function(){var t=new URLSearchParams;this.selection.forEach((function(e){return t.append("oid__in",e.oid)})),this.$refs.dataSelectionSave.save(this.dataset,t.toString())},saveAll:function(){this.$refs.dataSelectionSave.save(this.dataset,this.searchParams.toString())},searchOverlappingDatasets:function(){this.overlappingDatasetsModalTitle="Datasets overlapping selected ".concat(this.dataset.name," data"),this.overlappingDatasetsModalSearchFilter=new s.Z({dateRange:{min:new Date(Math.min.apply(Math,(0,i.Z)(this.selection.map((function(t){return new Date(t.date_beg)}))))),max:new Date(Math.max.apply(Math,(0,i.Z)(this.selection.map((function(t){return new Date(t.date_end)})))))},search:this.selection.map((function(t){return"(date_beg__lte = ".concat(t.date_end," and date_end__gte = ").concat(t.date_beg,")")})).join(" or ")}),this.$refs.overlappingDatasetsModal.show()}}},y=v,_=(0,p.Z)(y,r,n,!1,null,null,null),S=_.exports},10365:function(t,e,a){"use strict";var r=a(53111).end,n=a(76091);t.exports=n("trimEnd")?function(){return r(this)}:"".trimEnd},50863:function(t,e,a){var r=a(1702);t.exports=r(1..valueOf)},9653:function(t,e,a){"use strict";var r=a(19781),n=a(17854),i=a(1702),s=a(54705),o=a(98052),l=a(92597),c=a(79587),u=a(47976),d=a(52190),p=a(57593),h=a(47293),f=a(8006).f,m=a(31236).f,g=a(3070).f,b=a(50863),v=a(53111).trim,y="Number",_=n[y],S=_.prototype,w=n.TypeError,M=i("".slice),k=i("".charCodeAt),P=function(t){var e=p(t,"number");return"bigint"==typeof e?e:D(e)},D=function(t){var e,a,r,n,i,s,o,l,c=p(t,"number");if(d(c))throw w("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=v(c),e=k(c,0),43===e||45===e){if(a=k(c,2),88===a||120===a)return NaN}else if(48===e){switch(k(c,1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+c}for(i=M(c,2),s=i.length,o=0;o<s;o++)if(l=k(i,o),l<48||l>n)return NaN;return parseInt(i,r)}return+c};if(s(y,!_(" 0o1")||!_("0b1")||_("+0x1"))){for(var x,E=function(t){var e=arguments.length<1?0:_(P(t)),a=this;return u(S,a)&&h((function(){b(a)}))?c(Object(e),a,E):e},F=r?f(_):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),N=0;F.length>N;N++)l(_,x=F[N])&&!l(E,x)&&g(E,x,m(_,x));E.prototype=S,S.constructor=E,o(n,y,E)}},4723:function(t,e,a){"use strict";var r=a(46916),n=a(27007),i=a(19670),s=a(17466),o=a(41340),l=a(84488),c=a(58173),u=a(31530),d=a(97651);n("match",(function(t,e,a){return[function(e){var a=l(this),n=void 0==e?void 0:c(e,t);return n?r(n,e,a):new RegExp(e)[t](o(a))},function(t){var r=i(this),n=o(t),l=a(e,r,n);if(l.done)return l.value;if(!r.global)return d(r,n);var c=r.unicode;r.lastIndex=0;var p,h=[],f=0;while(null!==(p=d(r,n))){var m=o(p[0]);h[f]=m,""===m&&(r.lastIndex=u(n,s(r.lastIndex),c)),f++}return 0===f?null:h}]}))},48702:function(t,e,a){a(83462);var r=a(82109),n=a(10365);r({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==n},{trimEnd:n})},83462:function(t,e,a){var r=a(82109),n=a(10365);r({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==n},{trimRight:n})}}]);
//# sourceMappingURL=MetadataList.028fab3b.js.map