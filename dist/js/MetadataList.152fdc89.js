"use strict";(self["webpackChunkweb_client"]=self["webpackChunkweb_client"]||[]).push([[496,219],{6927:function(t,e,a){a.d(e,{Z:function(){return d}});var i=function(){var t=this,e=t._self._c;return e("nav",{attrs:{role:"navigation","aria-label":"Pagination","aria-controls":t.ariaControls}},[e("b-button",{staticClass:"mr-1",attrs:{disabled:1==t.currentPage,size:t.size,variant:"outline-dark",title:t.ariaLabel(t.jumpBackwardPage),"aria-label":t.ariaLabel(t.jumpBackwardPage)},on:{click:function(e){return t.selectPage(t.jumpBackwardPage)}}},[t._v(" « ")]),e("b-button-group",{attrs:{size:t.size}},t._l(t.pages,(function(a){return e("b-button",{key:a,attrs:{disabled:t.currentPage==a,variant:a==t.currentPage?"dark":"outline-dark",title:t.ariaLabel(a),"aria-label":t.ariaLabel(a),"aria-current":a==t.currentPage?"page":"false"},on:{click:function(e){return t.selectPage(a)}}},[t._v(" "+t._s(a)+" ")])})),1),e("b-button",{staticClass:"ml-1",attrs:{disabled:t.currentPage==t.pageCount,size:t.size,variant:"outline-dark",title:t.ariaLabel(t.jumpForwardPage),"aria-label":t.ariaLabel(t.jumpForwardPage)},on:{click:function(e){return t.selectPage(t.jumpForwardPage)}}},[t._v(" » ")])],1)},s=[],r=(a(7658),{name:"Pagination",props:{pageNumber:{type:Number,required:!0},pageCount:{type:Number,required:!0},pageJump:{type:Number,default:10},pageDisplayed:{type:Number,default:5},ariaControls:{type:String,default:null},size:{type:String,default:"md"}},data(){return{currentPage:this.pageNumber}},computed:{jumpBackwardPage(){return Math.max(1,this.currentPage-this.pageJump)},jumpForwardPage(){return Math.min(this.pageCount,this.currentPage+this.pageJump)},firstPage(){let t=Math.ceil(this.pageDisplayed/2);return Math.max(1,this.currentPage-t+1)},lastPage(){return Math.min(this.pageCount,this.firstPage+this.pageDisplayed-1)},pages(){let t=[];for(let e=this.firstPage;e<=this.lastPage;e++)t.push(e);return t}},watch:{pageNumber(t){this.currentPage=t}},methods:{selectPage(t){t!=this.currentPage&&(this.currentPage=t,this.$emit("change",this.currentPage))},ariaLabel(t){return t==this.currentPage?null:`Go to Page ${t}`}}}),l=r,n=a(1001),o=(0,n.Z)(l,i,s,!1,null,null,null),d=o.exports},9850:function(t,e,a){a.d(e,{_:function(){return l},Z:function(){return c}});var i=function(){var t=this,e=t._self._c;return e("b-modal",{attrs:{id:t.modalId,"aria-controls":t.ariaControls,title:"Table display settings","cancel-title":"Reset"},on:{show:t.initialiseSettings,ok:t.updateSettings,cancel:function(e){return e.preventDefault(),t.resetSettings.apply(null,arguments)}}},[e("b-form-group",{attrs:{"label-for":t.pageSizeSelectorId,label:"Number of rows to display"}},[e("b-form-spinbutton",{attrs:{id:t.pageSizeSelectorId,min:t.settings.pageSizeMinimum,max:t.settings.pageSizeMaximum,step:10,size:"sm"},model:{value:t.settings.pageSize,callback:function(e){t.$set(t.settings,"pageSize",e)},expression:"settings.pageSize"}})],1),t.columnOptions.length?e("b-form-group",{attrs:{label:"Display/hide columns"},scopedSlots:t._u([{key:"default",fn:function({ariaDescribedby:a}){return[e("v-select",{attrs:{multiple:"",options:t.columnOptions,"aria-describedby":a},model:{value:t.settings.columns,callback:function(e){t.$set(t.settings,"columns",e)},expression:"settings.columns"}})]}}],null,!1,3240276642)}):t._e(),t.orderingOptions.length?e("b-form-group",{attrs:{"label-for":t.orderingSelectorId,label:"Select sorting column"}},[e("b-form-select",{attrs:{id:t.orderingSelectorId,options:t.orderingOptions},model:{value:t.settings.ordering,callback:function(e){t.$set(t.settings,"ordering",e)},expression:"settings.ordering"}})],1):t._e()],1)},s=[],r=a(6318);a(7658);class l{constructor(t){(0,r.Z)(this,"pageSize",null),(0,r.Z)(this,"pageSizeMinimum",10),(0,r.Z)(this,"pageSizeMaximum",null),(0,r.Z)(this,"pageSizeStep",10),(0,r.Z)(this,"ordering",null),(0,r.Z)(this,"columns",[]),(0,r.Z)(this,"columnOptions",[]),t&&(Number.isInteger(t.pageSize)&&(this.pageSize=t.pageSize),Number.isInteger(t.pageSizeMinimum)&&(this.minimum=t.pageSizeMinimum),Number.isInteger(t.pageSizeMaximum)&&(this.maximum=t.pageSizeMaximum),Number.isInteger(t.pageSizeStep)&&(this.step=t.pageSizeStep),this.ordering=t.ordering,Array.isArray(t.columns)&&(this.columns=[...t.columns]),Array.isArray(t.columnOptions)&&(this.columnOptions=[...t.columnOptions]))}}var n={name:"TableSettingsModal",props:{defaultSettings:{type:l,required:!0},modalId:{type:String,default:null},ariaControls:{type:String,default:null}},data(){return{settings:new l,pageSizeSelectorId:this.$utils.getUniqueId(),orderingSelectorId:this.$utils.getUniqueId(),columnFilter:"",columnFilterId:this.$utils.getUniqueId()}},computed:{columnOptions(){let t=[...this.defaultSettings.columns],e=new Set(this.defaultSettings.columns.map((t=>t["key"])));for(const a of this.defaultSettings.columnOptions)e.has(a["key"])||(e.add(a["key"]),t.push(a));return t},orderingOptions(){let t=this.settings.columns.map((t=>({text:t["label"],value:t["key"]})));return t.length&&t.unshift({text:"",value:null}),t}},methods:{initialiseSettings(){this.settings=new l(this.defaultSettings)},updateSettings(){this.$emit("change",this.settings)},resetSettings(){this.settings=new l(this.defaultSettings)},clearColumnFilter(){this.columnFilter=""}}},o=n,d=a(1001),u=(0,d.Z)(o,i,s,!1,null,null,null),c=u.exports},3746:function(t,e,a){a.r(e),a.d(e,{default:function(){return d}});var i=function(){var t=this,e=t._self._c;return e("div",[e("b-img",{attrs:{src:t.imageURL,center:"","fluid-grow":"",alt:"Data thumbnail"}}),e("b-form-group",{staticClass:"my-2",attrs:{label:"Filter metadata","label-for":t.metadataFilterId,"label-sr-only":""}},[e("b-input-group",[e("b-form-input",{attrs:{id:t.metadataFilterId,type:"search",placeholder:"Filter metadata",title:"Type anything to filter the metadata on keyword or value",debounce:"250"},model:{value:t.metadataFilter,callback:function(e){t.metadataFilter=e},expression:"metadataFilter"}}),e("b-input-group-append",[e("b-button",{attrs:{disabled:!t.metadataFilter,title:"Clear the metadata filter"},on:{click:t.clearMetadataFilter}},[t._v("Clear")])],1)],1)],1),e("b-tabs",{attrs:{"content-class":"mt-3"}},[e("b-tab",{attrs:{title:"Metadata",active:""}},[e("b-table",{attrs:{items:t.metadataItems,fields:t.fields,filter:t.metadataFilter,"filter-included-fields":t.filterIncludedFields,"primary-key":"id","thead-class":"d-none",responsive:"","show-empty":"",small:""}})],1),t.fitsHeader?e("b-tab",{attrs:{title:"FITS header"}},[e("b-table",{attrs:{items:t.fitsHeaderItems,fields:t.fields,filter:t.metadataFilter,"filter-included-fields":t.filterIncludedFields,"primary-key":"id","thead-class":"d-none",responsive:"","show-empty":"",small:""}})],1):t._e()],1)],1)},s=[],r={name:"MetadataDetail",props:{metadata:{type:Object,required:!0}},data(){return{metadataFilter:"",metadataFilterId:this.$utils.getUniqueId(),fields:["text"],filterIncludedFields:["text"],forbiddenMetadataKeys:["fits_header","resource_uri","data_location","tags"]}},computed:{imageURL(){return this.metadata?.data_location?.thumbnail_url||a(1170)},fitsHeader(){return this.metadata.fits_header?this.metadata.fits_header.trimEnd():""},metadataItems(){return Object.entries(this.metadata).filter((([t])=>!this.forbiddenMetadataKeys.includes(t))).map((([t,e],a)=>({id:a,text:`${t} = ${e}`})))},fitsHeaderItems(){return this.fitsHeader.match(/[^]{1,80}/g).map(((t,e)=>({id:e,text:t})))}},methods:{clearMetadataFilter(){this.metadataFilter=""}}},l=r,n=a(1001),o=(0,n.Z)(l,i,s,!1,null,null,null),d=o.exports},9632:function(t,e,a){a.r(e),a.d(e,{default:function(){return _}});var i=function(){var t=this,e=t._self._c;return e("div",[e("b-overlay",{attrs:{show:t.paginator.loading,rounded:"sm"}},[e("b-button-toolbar",{staticClass:"mb-3",attrs:{"key-nav":"","aria-label":"Control table displayed rows and columns"}},[e("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal",value:t.tableSettingsModalId,expression:"tableSettingsModalId"}],attrs:{size:"sm",variant:"outline-secondary",title:"Change table display settings"}},[t._v("Settings")]),e("span",{staticClass:"button-toolbar-spacer"}),e("pagination",{staticClass:"mb-0",attrs:{"page-number":t.paginator.pageNumber,"page-count":t.paginator.pageCount,"aria-controls":t.tableId,size:"sm"},on:{change:t.updatePageNumber}})],1),e("b-table",{ref:"metadataTable",attrs:{id:t.tableId,items:t.paginator.items,fields:t.metadataTableFields,caption:t.metadataTableCaption,"primary-key":"oid","select-mode":"single",responsive:"",small:"",hover:"",selectable:""},on:{"row-selected":t.showMetadataDetailModal},scopedSlots:t._u([{key:"cell(checkbox)",fn:function(a){return[e("b-form-checkbox",{attrs:{value:a.item,size:"lg"},model:{value:t.selection,callback:function(e){t.selection=e},expression:"selection"}})]}},{key:"cell(download_button)",fn:function(t){return[e("b-button",{attrs:{href:t.value,target:"_blank",title:"Download file",size:"sm",variant:"primary",disabled:!t.item.data_location||t.item.data_location.offline}},[e("b-icon",{attrs:{icon:"download"}})],1)]}}])}),e("b-button-toolbar",{attrs:{"key-nav":"","aria-label":"Actions on displayed and selected rows"}},[e("b-button",{attrs:{disabled:t.selectionEmpty,variant:"primary",title:"Select one or more metadata to create or update a data selection"},on:{click:t.saveSelection}},[t._v("Save selection ("+t._s(t.selection.length)+")")]),e("b-button",{attrs:{variant:"primary",title:"Create or update a data selection with all metadata"},on:{click:t.saveAll}},[t._v("Save all")]),e("b-button",{attrs:{disabled:t.selectionEmpty,title:"Select one or more metadata to search for overlapping data"},on:{click:t.searchOverlappingDatasets}},[t._v("Search overlapping")])],1)],1),e("b-modal",{ref:"metadataDetailModal",attrs:{size:"md",title:t.metadataDetailModalTitle,"hide-footer":"",static:"",lazy:""}},[t.metadataDetailModalMetadata?e("metadata-detail",{attrs:{metadata:t.metadataDetailModalMetadata}}):t._e()],1),e("b-modal",{ref:"overlappingDatasetsModal",attrs:{size:"full",title:t.overlappingDatasetsModalTitle,"hide-footer":"",static:"",lazy:""}},[e("dataset",{attrs:{"initial-search-filter":t.overlappingDatasetsModalSearchFilter}})],1),e("data-selection-save",{ref:"dataSelectionSave"}),e("table-settings-modal",{attrs:{"default-settings":t.tableSettings,"modal-id":t.tableSettingsModalId,"aria-controls":t.tableId},on:{change:t.updateTableSettings}})],1)},s=[],r=(a(7658),a(9569)),l=function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{ref:"dataSelectionSaveModal",attrs:{size:"md",title:"Save data selection","ok-only":"","ok-variant":"success","hide-footer":!t.dataSelection},on:{hidden:t.resetModal}},[t.dataSelection?[t._v(" Your selection was saved successfully, and is available under the menu "),e("b-link",{attrs:{to:{name:"DataSelections"}}},[t._v('"Data selections"')])]:[e("b-overlay",{attrs:{show:t.showOverlay,rounded:"sm"}},[e("b-form",{on:{submit:function(e){return e.preventDefault(),t.saveDataSelection.apply(null,arguments)}}},[e("b-form-group",{attrs:{label:"Description","label-for":"data-selection-description",description:"Optional description of the data selection"}},[e("b-form-textarea",{attrs:{id:"data-selection-description",lazy:""},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}})],1),e("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("Save")])],1)],1),e("p",{staticClass:"text-muted mt-3"},[t._v(" Note: data selections are dynamic, if metadata corresponding to your selection is added, updated or deleted, the selection will be affected ")])]],2)],1)},n=[],o={name:"DataSelectionSave",data(){return{showOverlay:!1,description:null,dataSelection:null}},methods:{save(t,e){this.dataset=t,this.query_string=e,this.$refs.dataSelectionSaveModal.show()},async saveDataSelection(){this.showOverlay=!0;try{this.dataSelection=await this.$SVO.data_selection.create({description:this.description,dataset:this.dataset.resource_uri,query_string:this.query_string})}catch(t){this.$displayErrorMessage(this.$SVO.parseError(t))}this.showOverlay=!1},resetModal(){this.showOverlay=!1,this.description=null,this.dataSelection=null}}},d=o,u=a(1001),c=(0,u.Z)(d,l,n,!1,null,null,null),m=c.exports,p=a(9822),g=a(6927),h=a(9850),b=a(3746),f=a(4286),S={name:"MetadataList",components:{MetadataDetail:b["default"],Dataset:p["default"],DataSelectionSave:m,Pagination:g.Z,TableSettingsModal:h.Z},props:{dataset:{type:Object,required:!0},searchParams:{type:URLSearchParams,required:!0},tags:{type:Array,default:()=>[]},keywords:{type:Array,default:()=>[]},defaultColumns:{type:Array,required:!0}},data(){let t=this.$SVO.getPaginator(this.dataset.metadata.resource_uri),e=new h._({pageSize:t.pageSize,pageSizeMinimum:f.By.MINIMUM_PAGESIZE,pageSizeMaximum:f.By.MAXIMUM_PAGESIZE,ordering:t.ordering,columns:this.defaultColumns});return{tableId:this.$utils.getUniqueId(),paginator:t,selection:[],metadataDetailModalTitle:this.dataset.name,metadataDetailModalMetadata:null,overlappingDatasetsModalSearchFilter:new r.Z,overlappingDatasetsModalTitle:"Datasets",tableSettings:e,tableSettingsModalId:this.$utils.getUniqueId()}},computed:{metadataTableFields(){let t=[{key:"checkbox",label:""},{key:"download_button",label:"Download",formatter:(t,e,a)=>!a.data_location||a.data_location.offline?null:a.data_location.file_url},...this.tableSettings.columns];return this.tags.length&&t.push({key:"tags",label:"Tags",formatter:t=>t.map((t=>t.name)).join(", ")}),t},metadataTableCaption(){return this.paginator.items.length>0?"Click on any row to see data details":"No metadata correspond to your search criteria"},selectionEmpty(){return 0==this.selection.length}},watch:{searchParams:{handler:"updatePaginator",immediate:!0},keywords:{handler:"updateColumnOptions",immediate:!0}},methods:{updatePaginator(t){this.selection=[];try{this.paginator.searchParams=t,this.paginator.loadPage(1)}catch(e){this.$displayErrorMessage(this.$SVO.parseError(e))}},updateColumnOptions(){this.tableSettings.columnOptions=this.keywords.map((t=>({key:t["name"],label:t["verbose_name"],headerTitle:t["description"],formatter:"time (ISO 8601)"==t["type"]?this.$utils.formatDate:void 0})))},updatePageNumber(t){this.paginator.loadPage(t)},updateTableSettings(t){this.paginator.pageSize==t.pageSize&&this.paginator.ordering==t.ordering||(this.paginator.pageSize=t.pageSize,this.paginator.ordering=t.ordering,this.paginator.loadPage(1)),this.tableSettings=t},showMetadataDetailModal(t){t.length>0&&(this.metadataDetailModalMetadata=t[0],this.$refs.metadataTable.clearSelected(),this.$nextTick((function(){this.$refs.metadataDetailModal.show()})))},saveSelection(){let t=new URLSearchParams;this.selection.forEach((e=>t.append("oid__in",e.oid))),this.$refs.dataSelectionSave.save(this.dataset,t.toString())},saveAll(){this.$refs.dataSelectionSave.save(this.dataset,this.searchParams.toString())},searchOverlappingDatasets(){this.overlappingDatasetsModalTitle=`Datasets overlapping selected ${this.dataset.name} data`,this.overlappingDatasetsModalSearchFilter=new r.Z({dateRange:{min:new Date(Math.min(...this.selection.map((t=>new Date(t.date_beg))))),max:new Date(Math.max(...this.selection.map((t=>new Date(t.date_end)))))},search:this.selection.map((t=>`(date_beg__lte = ${t.date_end} and date_end__gte = ${t.date_beg})`)).join(" or ")}),this.$refs.overlappingDatasetsModal.show()}}},v=S,y=(0,u.Z)(v,i,s,!1,null,null,null),_=y.exports}}]);
//# sourceMappingURL=MetadataList.152fdc89.js.map